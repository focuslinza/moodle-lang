<h2>Moodle asennus</h2>
<p>Tämä ohje opastaa Moodlen ensiasennuksessa. Se kattaa
erilaisten www-palvelinten eroavaisuudet, joskus
yksityiskohtaisestikin, joten asennus saattaa näyttää
pitkältä ja monimutkaiselta. Yleensä Moodle on
kuitenkin asennettu muutamassa minuutissa.</p>
<p>Varaa aikaa lukeaksesi tämä ohje kokonaan läpi,
sitä hyötyä myöhemmin.</p>
<p>Ohjeen osat:</p>
<ol>
	<li><p style="margin-bottom: 0cm;"><a href="#requirements">Vaatimukset</a>
		</p>
	</li><li><p style="margin-bottom: 0cm;"><a href="#downloading">Lataus</a> 
	</p>
	</li><li><p style="margin-bottom: 0cm;"><a href="#site">Sivuston rakenne</a></p>
	</li><li><p style="margin-bottom: 0cm;"><a href="#data">Luo data-hakemisto</a></p>
	</li><li><p style="margin-bottom: 0cm;"><a href="#database">Luo tietokanta</a></p>
	</li><li><p style="margin-bottom: 0cm;"><a href="#webserver">Tarkista
	www-palvelimen asetukset</a></p>
	</li><li><p style="margin-bottom: 0cm;"><a href="#config">Muokkaa
	config.php</a> 
	</p>
	</li><li><p style="margin-bottom: 0cm;"><a href="#admin">Mene ylläpito
	sivulle</a></p>
	</li><li><p style="margin-bottom: 0cm;"><a href="#cron">Aseta cron</a> 
	</p>
	</li><li><p><a href="#course">Luo uusi kurssi</a></p>
</li></ol>
<h3><a name="requirements"></a>1. Vaatimukset</h3>
<blockquote>Moodle kehitetään ensisijaisesti
 Linux-ympäristössä käyttäen PHP, Apache ja
MySQL -ohjelmistoja, sitä testataan jatkuvasti myös PostgreSQL ,
Windows XP, Mac OS X ja Solaris -ympäristöissä.</blockquote>
<blockquote>Kaikki mitä tarvitset on:</blockquote>
<ol>
	<li><blockquote style="margin-bottom: 0cm;">Toimiva <a href="http://www.php.net/">PHP</a>
	(version 4.1.0 or later) asennus, seuraavat toiminnot pitää
	olla aktivoituna ( nämä toiminnot avat vakiona päällä
	miltei jokaisessa PHP asennuksessa): 
	</blockquote>
	<ul>
		<li><blockquote style="margin-bottom: 0cm;"><a href="http://www.boutell.com/gd/">GD
		kirjasto</a> joka tukee JPG ja PNG -tiedostomuotoja. ( PHP versio =&gt; 4.3
		sisältää oman GD-kirjaston)</blockquote>
		</li><li><blockquote style="margin-bottom: 0cm;">Sessiotuki</blockquote>
		</li><li><blockquote style="margin-bottom: 0cm;">Tiedostojen lähetys sallittu 
		</blockquote>
	</li></ul>
	</li><li><blockquote>Toimiva tietokantapalvelin : <a href="http://www.mysql.com/">MySQL</a>
	tai <a href="http://www.postgresql.org/">PostgreSQL</a> (7.x) ovat
	suositeltavia. (MSSQL, Oracle, Interbase, Foxpro, Access, ADO,
	Sybase, DB2 tai ODBC ovat teoriassa tuettuja mutta joudut asentamaan
	tietokannan käsin.). 
	</blockquote>
</li></ol>
<blockquote>Windows-ympäristössä on helpointa ladata
<a href="http://www.foxserv.net/">FoxServ</a>, tai <a href="http://www.easyphp.org/">EasyPHP</a>
jotka asentavat Apache, PHP, ja MySQL palvelimet. Muista ottaa GD-moduli käyttöön jotta  Moodle voi käsitellä
kuvia -voit joutua muokkaamaan php.ini-tiedostoa ja poistamaan
kommentin (;)riviltä: 'extension=php_gd.dll'. Muuta myös
hakemisto session.save_path - oletuksesta &quot;/tmp&quot; käyttämään
Windows-hakemistoa kuten  &quot;c:/temp&quot;.</blockquote>
<blockquote>Mac OS X ympäristöön suosittelen the <a href="http://fink.sourceforge.net/">fink</a>
projektia josta löydät helposti ladattavat paketit kaikkeen
tarvittavaan. Jos et ole tottunut komentokehotteen käyttäjä,
<a href="http://www.entropy.ch/software/macosx/php/">Marc
Liyanage's PHP Apache Module</a> on helpoin tapa saada php-toimimaan
apachen kanssa.</blockquote>
<blockquote>Jos käytät  Linuxia tai muuta  Unixia
silloin osaat varmaan tehdä kaiken jo itse ;-) 
</blockquote>
<p> </p>
<h3><a name="downloading"></a>2. Lataus</h3>
<blockquote>Voit ladata Moodlen joko pakettina tai viimeisen version
suoraan CVS:stä. Yksityskohdat lataamisesta on selostettu
sivulla <a href="http://moodle.com/">http://moodle.com/</a></blockquote>
<blockquote>Lataamisen ja paketin purkamisen jälkeen, tai kun
ole hakenut tiedostot  CVS:stä, sinulla on hakemisto
nimeltä moodle, mikä sisältää muita tiedostoja
ja hakemistoja.</blockquote>
<blockquote>Sijoita tämä kansio www-hakemistoon jolloin
sivustosi osoite on  <b>http://yourwebserver.com/moodle</b>, tai
kopioi hakemiston sisältö suoraan www-hakemistoon jolloin
sivustosi osoitteeksi tulee  <b>http://yourwebserver.com</b>.</blockquote>
<p> </p>
<h3><a name="site"></a>3. Sivuston rakenne</h3>
<blockquote>Tässä lyhyt kuvaus sisuston rakenteesta</blockquote>
<blockquote style="margin-left: 3cm; margin-right: 3cm;">config.php -
asetustiedosto, ainut jota sinun pitää muokata<br />version.php
- määrittää moodlen version<br />index.php -
sivuston etusivu</blockquote>
<ul>
	<li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">admin/
	- ylläpitoon liittyvät sivut</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">auth/
	- käyttäjäntunnistusmodulit</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">course/
	- kurssien hallintaan liittyvä koodi</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">doc/ -
	ohjeet 
	</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">files/
	- tiedostojen hallintaan liityvä koodi</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">lang/
	- Moodlen käännös tiedostot eri kielille kukin omassa
	hakemistossaan</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">lib/ -
	Moodlen ydinkirjastot</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">login/
	- sisäänkirjautuminen 
	</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">mod/ -
	kurssi modulit</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">pix/ -
	yleinen sivustografiikka</blockquote>
	</li><li><blockquote style="margin-right: 3cm; margin-bottom: 0cm;">theme/
	- ulkoasuteemat</blockquote>
	</li><li><blockquote style="margin-right: 3cm;">user/ -
	Käyttäjänhallintaan liittyvä koodi</blockquote>
</li></ul>
<blockquote style="margin-left: 3cm; margin-right: 3cm;"> </blockquote>
<h3><a name="data"></a>4. Luo data-hakemisto</h3>
<blockquote>Moodle tarvitsee levytilaa tallentaakseen palautetut
tehtävät, osallistujien kuvat ja muuta.</blockquote>
<blockquote>Luo hakemisto jonnekin kiintolevyllesi. Älä
sijoita tätä hakemistoa www-hakemistoon tietotuvan takia.
Helpointa on valita hakemisto www-hakemiston ulkopuolelta, muulloin
suojaa hakemisto tiedostolla .htaccess, joka sisältää
rivin: 
</blockquote>
<pre style="margin-left: 2cm; margin-right: 2cm; margin-bottom: 0.5cm;">deny from all</pre><blockquote>
Varmistaaksesi että moodle voi tallenta tiedostoja
hakemistoon, tarkista että www-palvelimella (eli apache) on
oikeudet kirjoittaa tuohon hakemistoon. Unix koneilla tämä
yleensä tarkoittaa hakemiston omistajan asettamista joko &quot;apache&quot;
tai &quot;nobody&quot; komennolla chown. 
</blockquote>
<blockquote>Jos käytät jaettua palveluntarjoajan
palvelinta, kysy ylläpidolta miten voit tehdä asetukset
turvallisesti.</blockquote>
<h3><a name="database"></a>5. Luo tietokanta</h3>
<blockquote>Tarvitset tyhjän tietokannan (esim &quot;moodle&quot;)
tietokanta järjestelmään ja erityisen käyttäjän
(esim &quot;moodleuser&quot;) jolla on oikeudet tuohon kantaan (ja
vain tuohon kantaan). Älä köytä root-tunnusta, se
luo suuren tietoturvariskin.</blockquote>
<blockquote>Esimerkkikomennot MySQL: 
</blockquote>
<pre style="margin-left: 1cm; margin-right: 1cm;">   # mysql -u root -p<br />   &gt; CREATE DATABASE moodle; <br />   &gt; GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,INDEX,ALTER ON moodle.* <br />           TO moodleuser@localhost IDENTIFIED BY 'yourpassword'; <br />   &gt; quit <br />   # mysqladmin -p reload</pre><blockquote>
Esimerkkikomennot PostgreSQL: 
</blockquote>
<pre style="margin-left: 1cm; margin-right: 1cm;">   # su - postgres<br />   &gt; psql -c &quot;create user moodleuser createdb;&quot; template1<br />   &gt; psql -c &quot;create database moodle;&quot; -U moodleuser template1<br />   &gt; psql -c &quot;alter user moodleuser nocreatedb;&quot; template1</pre><blockquote>
(MySQL käytäjän kannattaa tutustua  <a href="http://phpmyadmin.sourceforge.net/">phpMyAdmin</a>
helpottaakseen tietokannan hallintaa).</blockquote>
<blockquote>Nykyisin moodle käyttää etuliitteitä
tauluissaan joten voit myös käyttää olemassa
olevaa tietokantaa Moodlen kanssa.</blockquote>
<p> </p>
<h3><a name="webserver"></a>6. Tarkista www-palvelimen asetukset</h3>
<blockquote>Tarkista ensin, että palvelin käyttää
oletussivuna index.php-tiedostoja  (ja tietenkin myös
index.html, default.htm ja muut voivat olla myös
   käytössä, jos tarvitset niitä muualla).</blockquote>
<blockquote>Apachessa tämä asetus on   DirectoryIndex 
httpd.conf tiedostossa. Esimerkki rivi näyttää siis
tältä:</blockquote>
<pre style="margin-left: 2cm; margin-right: 2cm; margin-bottom: 0.5cm;">DirectoryIndex index.php index.html index.htm </pre><blockquote>
Se riittää että index.php on listassa, sijainnilla ei
ole väliä (ellet sitten halua hioa php-suorituskykyä
huippuunsa).</blockquote>
<blockquote>Toiseksi, tarkista että Moodlen käyttämät
asetukset ovat oikein php.ini-tiedostossa. <b>Useimmat palvelimet on
jo asetettu käyttämään näitä asetuksia.</b>
Kuitenkin jotkut PHP-palvelimet (ja jotkut viimeisimmät
PHP-versiot) voivat olla asetettuna toimimaan toisin. Tarkista
seuraavat asetukset php.ini-tiedostosta:</blockquote>
<pre style="margin-left: 2cm; margin-right: 2cm;">magic_quotes_gpc = On<br />magic_quotes_runtime = Off<br />file_uploads = On<br />short_open_tag = On<br />session.auto_start = Off<br />session.bug_compat_warn = Off</pre><blockquote>
Jollei sinulla ole pääsyä muokkaamaan palvelimen
httpd.conf tai php.ini -tiedostoja, tai joku muu palvelimen sovellus
vaatii eri asetukset, voit YLIMÄÄRITELLÄ palvelimen
oletus-asetukset.</blockquote>
<blockquote>Ylimääritelläksesi oletus-asetukset tee 
<b>.htaccess</b> tiedosto Moodle'n päähakemistoon . (Tämä
toimii ainoastaan apache-palvelimella kun AllowOverride on päällä.</blockquote>
<pre style="margin-left: 2cm; margin-right: 2cm;">DirectoryIndex index.php index.html index.htm<br />php_flag magic_quotes_gpc On<br />php_flag magic_quotes_runtime Off<br />php_flag file_uploads On<br />php_flag short_open_tag On<br />php_flag session.auto_start Off<br />php_flag session.bug_compat_warn Off</pre><blockquote>
Voit myös määritellä suurimman sallitun tiedoston
koon: 
</blockquote>
<pre style="margin-left: 2cm; margin-right: 2cm;">php_value upload_max_filesize 2M<br />php_value post_max_size 2M<br />     </pre><blockquote>
Helpointa on ottaa lib/htaccess tiedosto pohjaksi ja muokata sitä
tarpeen mukaan:</blockquote>
<pre style="margin-left: 2cm; margin-right: 2cm; margin-bottom: 0.5cm;">cp lib/htaccess .htaccess</pre><p>
 </p>
<h3><a name="config"></a>7. Muokkaa config.php</h3>
<blockquote>Nyt voit muokata asetustiedostoa ,<strong>config.php</strong>.
Tämä on ainoa Moodlen tiedosto jota sinun tarvitsee muokata
.</blockquote>
<blockquote>Päästäksesi alkuun kopioi config-dist.php
tiedostoksi  config.php. Emme sisällytä
config.php-tiedostoa suoraan pakettiin, jottei asetukset hukkuisi
esim. Moodlen päivityksen yhteydessä.</blockquote>
<blockquote>Muokaa config.php tiedostoa ja kirjoita asetukset sinne
(muista  &quot;table prefix&quot; - PostgreSQL ei toimi ilman
tätä), sivuston osoite, sivuston sijanti palvelimen
tiedostojärjestelmässä ja datahakemisto. config.php
tiedostossa on tarvittavat ohjeet.</blockquote>
<blockquote>Tämän ohjeen loppuun asti oletamme sivustosi
sijaitsevan osoitteessa: <u>http://example.com/moodle</u></blockquote>
<p> </p>
<h3><a name="admin"></a>8. Mene ylläpitosivulle</h3>
<blockquote>Ylläpitosivun pitäisi nyt toimia osoitteesta:
<u>http://example.com/moodle/admin</u>. Jos koitat mennä suoraan
Moodlen etusivulle sinut ohjataan ylläpitosivulle. Esimmäisellä
kertaa sinulle esitetään GPL-lisenssi jonka ehdot sinun
pitää hyväksyä, jotta asennusta voidaan jatkaa.</blockquote>
<blockquote>(Moodle käyttää evästeitä (cookies) ja
eikä toimi oikein jos estät evästeiden tallentamisen
selaimeesi!) 
</blockquote>
<blockquote>Nyt Moodle aloittaa tietokannan luonnin. Näet
tietokannan luomiseen liittyviä käskyjä ja niiden jälkeen tila-viestin (vihreä
tai punainen) komennon onnistumisesta:</blockquote>
<blockquote style="margin-left: 3cm; margin-right: 3cm;">CREATE TABLE
course ( id int(10) unsigned NOT NULL auto_increment, category
int(10) unsigned NOT NULL default '0', password varchar(50) NOT NULL
default '', fullname varchar(254) NOT NULL default '', shortname
varchar(15) NOT NULL default '', summary text NOT NULL, format
tinyint(4) NOT NULL default '1', teacher varchar(100) NOT NULL
default 'Teacher', startdate int(10) unsigned NOT NULL default '0',
enddate int(10) unsigned NOT NULL default '0', timemodified int(10)
unsigned NOT NULL default '0', PRIMARY KEY (id)) TYPE=MyISAM</blockquote>
<blockquote style="margin-left: 3cm; margin-right: 3cm;"><font color="#006600">SUCCESS</font></blockquote>
<blockquote style="margin-left: 3cm; margin-right: 3cm;">.. ja niin
edelleen: <font color="#ff0000">Main databases set up successfully</font>.
</blockquote>
<blockquote>Jos tietokantaa ei pystyä luomaan virheettä
joko php-asetuksissa , tietokannassa tai  config.php tiedoston
asetuksissa on vikaa. Tarkista  ettei PHP ole rajatussa &quot;safe
mode&quot;-tilassa (monien palveluntarjoajien palvelimen yleensä
on)Voit tarkistaa php:n asetukset luomalla tiedosto info.php jossa on
rivi &lt;? phpinfo() ?&gt; ja katsoa sitä selaimella  .
tarkista vielä kaikki asetukset ja eritä uudelleen.</blockquote>
<blockquote>Sivun lopusta löytyy &quot;Continue&quot; tai
&quot;Jatka&quot; linkki, jatka sillä.</blockquote>
<blockquote>Seuraava sivu asettaa kurssimodulien tarvitsemat taulut.
Taas kaiken pitäisi näyttä vihreää.</blockquote>
<blockquote>Sivun lopusta löytyy &quot;Continue&quot; tai
&quot;Jatka&quot; linkki, jatka sillä.</blockquote>
<blockquote>Seuraavalla sivulla on lomake jolla määritellään
sivuston muuttujat ( Oletuskieli, käytettävä
lokalisointi ,SMTP(posti)-palvelimet jne..). Älä murehdi
liikaa asetuksia, voit aina palata muuttamaan niitä. Tallenna
muutokset ja jatka asennusta.</blockquote>
<blockquote>Jos  (ja vain jos) juutut tälle sivulle etkä
pysty jatkamaan, www-palvelimesi on ongelma mitä kutsumme 
&quot;buggy referrer&quot; ongelmaksi. Tämä on helppo
korjata: muokkaa config.php ja aseta muuttuja buggy_referrer = <i>true</i>,
ja yritä uudelleen.</blockquote>
<blockquote>Seuraavalla sivulla määrität sivustolle
nimen ja kuvauksen. Voit muuttaa näitäkin myöhemmin.
Tallenna muutokset ja jatka.</blockquote>
<blockquote>Lopuksi määrittelet pääkäyttäjä
tunnuksen sivustolle. Täytä henkilötietosi, email jne
ja tallenna muutokset &quot;Save changes&quot;. . 
</blockquote>
<blockquote style="margin-left: 7cm; margin-right: 7cm;"><strong>Paina
mieleen antamasi ylläpitäjän tunnus ja salasana,
tarvitset niitä myöhemmin. ;-)</strong></blockquote>
<blockquote>Kun pääkäyttäjä on luotu pääset
ylläpito valikkoon , josta löytyy linkit sivuston
ylläpitämiseksi, kuten:</blockquote>
<ul>
	<li><blockquote style="margin-bottom: 0cm;">kurssien lisääminen
	ja poisto</blockquote>
	</li><li><blockquote style="margin-bottom: 0cm;">Käyttäjätunnusten
	hallinta</blockquote>
	</li><li><blockquote style="margin-bottom: 0cm;">Opettajien hallinta</blockquote>
	</li><li><blockquote style="margin-bottom: 0cm;">Teemojen valinta 
	</blockquote>
	</li><li><blockquote>Käyttäjätunnistuksen valinta. (Voit
	käyttää esim. LDAP-palvelinta käyttäjän
	tunnistukseen)</blockquote>
</li></ul>
<p> </p>
<h3><a name="cron"></a>9. Aseta cron</h3>
<blockquote>Jotkut Moodlen modulit vaativat ajastettuja ajoja
toimiakseen. Esimerkiksi Foorumit tarkistetaan ajoittain, ja uusista
viesteistä lähetetään kopiot tilaajille.</blockquote>
<blockquote>Yksi scripti tekee kaiken tarvittavan ja on nimeltään
admin/cron.php. Sitä ei voida kuitenkaan ajaa automaattisesti,
vaan sinun pitää ajastaa scripti ajettavaksi esim. 5
minuutin välein.</blockquote>
<blockquote>Huomaa ettei ajastettavan koneen tarvitse olla sama jolla
Moodle on asennettu. Jos palveluntarjoajallasi ole cron-palvelua voit
ajastaa oman kotikoneesi ajamaan/hakemaan admin/cron.php scriptin
tietyin väliajoin.</blockquote>
<blockquote>Tarkista ensin selaimellasi  että scripti
toimii osoitteesta:</blockquote>
<pre style="margin-left: 2cm; margin-right: 2cm; margin-bottom: 0.5cm;">http://example.com/moodle/admin/cron.php</pre><h4 style="margin-left: 1cm; margin-right: 1cm; margin-top: 0cm;">
Scrptin ajamisen automatisointi</h4>
<blockquote>Unix-järjestemissä: käytä
<b>cron</b>ia.Muokkaa cron asetuksia komenolla  &quot;crontab
-e&quot;ja lisää rivi:</blockquote>
<pre style="margin-left: 2cm; margin-right: 2cm;">*/5 * * * * {komento}<br /><br />missä {komento} on:<br />wget -q -O /dev/null http://example.com/moodle/admin/cron.php<br />tai<br />lynx -dump http://example.com/moodle/admin/cron.php &gt; /dev/null<br />tai<br />/opt/bin/php /web/moodle/admin/cron.php</pre><blockquote>
Windows järjestelmissä: Helpointa on käyttää
pakettia <a href="http://moodle.com/download/moodle-cron-for-windows.zip">moodle-cron-for-windows.zip</a>
joka tekee ajastuksesta tosi helppoa. Voit myös käyttää
windowsin &quot;Scheduled Tasks&quot;/&quot;Ajastetut
toiminnot&quot;-toimintoa.<br />Komento on esim: 
</blockquote>
<pre style="margin-left: 1cm; margin-right: 1cm; margin-bottom: 0.5cm;">C:\apache\php\php.exe C:\apache\htdocs\moodle\admin\cron.php</pre><h3 style="margin-left: 1cm; margin-right: 1cm; margin-top: 0cm;">
<a name="course"></a>10. Luo uusi kurssi</h3>
<blockquote>Nyt kun Moodle on asennettu, voit luoda ensimmäisen
kurssin. 
</blockquote>
<blockquote>Valitse &quot;Luo uusi kurssi&quot; ylläpito
sivulta.</blockquote>
<blockquote>Täytä kussin tiedot, opettaja voi kuitenkin
aina halutessaan muuttaa kurssin tietoja, joten sinun ei tarvitse
käyttää turhaan aikaa pähkäilessäsi
kurssien kuvauksia tai muuta.</blockquote>
<blockquote>Paina  &quot;Talleta muutokset&quot;, jonka jälkeen
sinun pitää valita kurssille opettaja(t).Voit lisätä
opettajaksi ainoastaan käyttäjän joka on jo
järjestelmässä. 
</blockquote>
<blockquote>Kun olet valinnut opettajan/opettajat kurssi on valmis
käyttöön ja näkyvissä Moodlen etusivulla.</blockquote>
<blockquote>Katso  &quot;Opettajan käsikirja&quot;:sta
lisätietoja kurssien rakentamisesta.</blockquote>