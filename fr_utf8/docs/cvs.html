<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<title>Documentation Moodle : Comment utiliser CVS ?</title>

	<link rel="stylesheet" href="docstyles.css" type="text/css" />

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<style type="text/css">
		<!--
		ol {margin-left:40px;}
		.style1 {color: #990000}
		.style3 {color: #990000; font-weight: bold; }
		.style4 {color: #0000CC; font-weight: bold; }
		-->
	</style>

</head>

<body>

<h1>CVS pour les développeurs de Moodle</h1> 

<blockquote>

	<p>CVS est un acronyme pour désigner le « <strong>Concurrent Versioning System</strong> », une façon pratique et très répandue de stoquer le code source de projets informatiques. Un CVS conserve toutes les versions de tous les fichiers, de sorte qu'aucune donnée n'est jamais perdue, et que les traces de l'utilisation par les différentes personnes sont conservées. Le système offre en outre la possibilité de fusionner le code si plusieurs personnes travaillent sur un même fichier. Tout le code et toutes les versions sont enregistrées sur un serveur central (dans le cas de Moodle, sur <a  href="http://www.sf.net/">Sourceforge</a>).</p>

	<p>Si vous désirez simplement télécharger par CVS la version actuelle de Moodle pour lancer un site, vous n'avez pas besoin de cette page. Il vous suffit de suivre les instructions (plus simples) pour télécharger Moodle par CVS sur la page <a  href="http://moodle.org/download">Téléchargement de Moodle</a>.</p>

	<h2>Thèmes de ce document</h2>

	<ol>

		<li><a href="#sec1">Rejoindre le projet en tant que développeur</a></li>
		
		<li><a href="#sec2">Modules CVS</a> </li>
		
		<li><a href="#sec3">Commandes CVS de base</a><br />
		
				3.1. <a href="#sec3.1">CVS sur Unix ou Mac OS X</a><br />
				3.2. <a href="#sec3.2">CVS sous Windows</a>
		
		</li>
		
		<li><a href="#sec4">Travailler avec des branches</a><br />
		
				4.1. <a href="#sec4.1">Développement du tronc</a><br />
				
				4.2. <a href="#sec4.2">Branches stables pour chaque version</a><br />
				
				4.3. <a href="#sec4.3">Branches particulières pour tout changement important</a>
		
		</li>
	</ol>

	<p> </p>
	
	<h2><a name="sec1" id="sec1"></a>1. Rejoindre le projet en tant que développeur</h2>
	
	<blockquote>

	<p>On vient de vous proposer un accès en écriture au CVS pour vous permettre de nous aider à développer et à maintenir Moodle ? <a href="http://sourceforge.net/project/memberlist.php?group_id=30935">Bienvenue au club</a> !</p>
	
	<p>Pour avoir l'autorisation d'écrire dans l'<a  href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/moodle/moodle/">archive CVS de Moodle</a>, il vous faut avant tout un compte sur Sourceforge (<a href="http://sourceforge.net/account/register.php">l'enregistrement</a> est simple et gratuit). Nous admettrons pour les exemples de ce texte que votre nom d'utilisateur chez Sourceforge est <strong><font color="#990000">myusername</font></strong> et que votre mot de passe est <strong><font color="#990000">mypassword</font></strong>. Lisez attentivement les instructions de Sourceforge (en anglais) pour <a  href="http://sourceforge.net/docman/display_doc.php?docid=768&amp;group_id=1#develhomedir">créer votre dossier CVS initial</a> (home directory) — une procédure que vous devez faire pour chaque nouveau dossier en vue de l'utiliser avec le CVS. Il s'agit simplement de vous connecter à l'adresse cvs.sourceforge.net via le protocole SSH.</p>
	
	<p>Dès que votre compte Sourceforge est actif, contactez <a  href="http://moodle.org/user/view.php?id=1&amp;course=1">Martin Dougiamas</a> pour qu'il puisse vous donner les droits en écriture sur certains dossiers de Moodle.</p>
	
	<p>Pour éviter de devoir taper <strong><font color="#990000">mypassword</font></strong> chaque fois que vous lancez une commande CVS, suivez les <a  href="http://sourceforge.net/account/editsshkeys.php">instructions de Sourceforge pour l'utilisation de clefs d'autorisation</a> (en anglais). Cette étape n'est pas obligatoire, mais elle rend votre travail avec CVS bien plus agréable et productive.</p>
	
	<p>Une fois cela fait, vous devriez avoir toutes les autorisations nécessaires, et vous pouvez configurer votre machine et télécharger les sources actuelles pour y travailler.</p>

	<p> </p>

    </blockquote>

    <h2><a name="sec2" id="sec2"></a>2. Modules CVS</h2>

    <blockquote>	

	<p>Dans le jargon de CVS, les « Module » sont des collections séparées de code. Moodle possède les modules suivants :</p>

		<blockquote>	

		<p><strong>moodle</strong> : le code source pricipal de Moodle</p>	

		<p><strong>contrib</strong> : les contributions d'utilisateurs et du code en développement</p>	

		<p><strong>mysql</strong> : un phpMyAdmin adapté pour l'administration de la base de données dans Moodle</p>	

		<p><strong>windows-cron</strong> : un petit programme rendant possible l'exécution de crons sous Windows</p>	

		<p><strong>docs</strong> : diverses documentations supplémentaires mises à disposition par des utilisateurs</p>	

		</blockquote>	

	<p>La plupart des développeurs travaillent sur des fonctionnalités existantes dans le module <strong>moodle</strong>, mais beaucoup proposent aussi de nouvelles idées dans le module <strong>contrib</strong>. Lorsque du code atteint un certain niveau de maturité dans la zone <strong>contrib</strong>, il peut être déplacé dans le module principal <strong>moodle</strong>.</p>

	<p> </p>

    </blockquote>

    <h2><a name="sec3" id="sec3"></a>3. Commandes CVS de base</h2>

    <blockquote>	

    <h3><a name="sec3.1" id="sec3.1"></a>3.1 CVS sur Unix ou Mac OS X</h3>

	<blockquote>		

		<p>Le CVS de Sourceforge utilise SSH comme couche de transport pour la sécurité. Vous devrez donc configurer la variable d'environnement CVS_RSH dans votre « shell » comme ci-dessous. Le mieux est de placer cette commande dans votre .bashrc ou .cshrc afin que vous n'ayez pas à la retaper tout le temps :</p>

	<div class="commandline">setenv CVS_RSH ssh <em>(pour csh, tcsh, etc.)</em><br />
	export CVS_RSH=ssh <em>(pour sh, bash, etc.)</em></div>

	<p>Ensuite, vous devrez effectuer un « check out » de Moodle avec la commande ci-dessous (sur une seule ligne) :</p>

	<div class="commandline">cvs -z3 -d:ext:<font color="#990000">myusername</font>@cvs.sourceforge.net:/cvsroot/moodle co moodle</div>

	<p>La commande est similaire pour d'autres modules :</p>

	<div class="commandline">cvs -z3 -d:ext:<font color="#990000">myusername</font>@cvs.sourceforge.net:/cvsroot/moodle co contrib</div>

	<p>Ne tentez pas de lancer cette première commande CVS dans une installation de Moodle préexistante. Commencez avec un nouveau dossier vide.</p>

	<p>Vous devrez taper <strong><font color="#990000">mypassword</font></strong> pour chaque commande, à moins que vous ne mettiez en place des <a  href="http://sourceforge.net/account/editsshkeys.php">clefs autorisées</a>.</p>

	<p>À ce stade, vous devriez avoir un nouveau dossier « moodle ». Vous pouvez changer son nom et le déplacer à votre convenance. Placez-vous dans ce dossier :</p>

	<div class="commandline">cd moodle</div>

	<p>Les toutes dernières versions des fichiers de Moodle devrait y être. Vous pouvez mainteannt modifier les fichiers de votre copie. Pour comparer vos fichiers avec ceux du serveur CVS, utilisez la commande cvs diff, par exemple :</p>

	<div class="commandline">cvs diff -c config-dist.php<br />
	cvs diff -c lang</div>

	<p>Pour récupérer les dernières mises à jour de Moodle, tapez :</p>

	<div class="commandline">cvs update -dP</div>

	<p>Pour transférer vos nouveaux fichiers sur le serveur, vous devrez taper quelque chose comme :</p>

	<div class="commandline">cd lang/fr<br />
	cvs commit</div>
	
	<p>Vous devrez taper un commentaire. Votre éditeur de texte s'ouvrira. Écrivez quelque chose qui ait un sens et fermer l'éditeur de texte. Les fichiers seront envoyés chez Sourceforge et enregistrés. C'est tout !</p>
	
	<p>Pour vous économiser du temps, vous pouvez placer les arguments par défaut dans un fichier appelé .cvsrc dans votre dossier de départ. Par exemple, le mien contient :</p>
	
	<div class="commandline">diff -c<br />update -dP</div>
	
	<p>Taper « cvs help » pour plus de détails ...</p>
	
	<p> </p>
	
	</blockquote>
	
	<h3><a name="sec3.2" id="sec3.2"></a>3.2 CVS sous Windows</h3> 
	
	<blockquote>
	
	<p>Pour commencer, il vous faut télécharger une copie complète de Moodle avec votre compte développeur.</p>
	
	</blockquote>
	
	<ol>
	
		<li>Téléchargez TortoiseCVS depuis le site <a  href="http://www.tortoisecvs.org/">tortoisecvs.org</a> et installez-le, puis redémarrez votre machine.</li>
		
		<li>Trouvez ou créez un nouveau dossier dans lequel vous allez télécharger Moodle.</li>
		
		<li>Cliquez sur ce dossier avec le bouton droit de la souris et sélectionnez dans le menu l'option « <strong>CVS Checkout</strong> ». Une boîte de dialogue s'affiche alors.</li> 
		
		<li>Copiez le texte ci-dessous dans le champ CVSROOT (en y plaçant votre nom d'utilisateur !) : <br /><br />
		
		<div class="commandline">:ext:<font color="#990000">myusername</font>@cvs.sourceforge.net:/cvsroot/moodle</div></li> 
		
		<li>Sous le champ « Module », tapez « <strong>moodle</strong> » pour obtenir la dernière version de développement de Moodle, « <strong>contrib</strong> » pour obtenir le dossier des contributions et « <strong>mysql</strong> » pour obtenir le module MySQL Admin.</li>
		
		<li>Cliquez sur le bouton « <strong>OK</strong> » tout sera alors téléchargé.</li>
		
	</ol>
	
	<blockquote>
	
	<p>Une boîte de dialogue affichera tous les fichiers en cours de téléchargement, et après quelques instants vous aurez votre copie complète de Moodle. Après ce premier « check out », vous pourrez récupérer les derniers fichiers modifiés sur le serveur CVS :</p>
	
	</blockquote>
	
	<ol>
		
		<li>Cliquez avec le bouton droit de la souris sur votre dossier Moodle (ou sur n'importe quel fichier) et sélectionnez « <strong>CVS Update</strong> ».</li>
		
		<li>Attendez et voyez défiler les historiques (logs). Prenez note des conflits pouvant survenir si votre code local a des modifications en contradiction avec les versions téléchargées. Vous aurez à résoudre manuellement ces fichiers en les modifiant.</li>
		
	</ol>
	
	<blockquote>
	
	<p>Après une modification de fichiers (vous remarquerez que la couleur de leur icône passe alors du vert au rouge), vous pouvez les envoyer sur le serveur CVS de la façon suivante :</p>
	
	</blockquote>
	
	<ol>
		
			<li>Cliquez avec le bouton droit de la souris sur votre dossier Moodle (ou sur n'importe quel fichier) et sélectionnez « <strong>CVS Commit...</strong> ».</li>
			
			<li>Dans la boîte de dialogue, taper une description claire des changements que vous avez effectués.</li>
			
			<li>Cliquez « OK ». Vos modifications sont alors envoyées vers le serveur CVS.</li> 
	
	</ol>
	
	<p> </p>
	
	</blockquote>
	
	<h2><a name="sec4" id="sec4"></a>4. Travailler avec des branches</h2>
	
	<blockquote>
	
	<p>Le diagramme suivant montre comment le module principal <strong>moodle</strong> se ramifie en plusieurs versions (branches) au cours du temps.</p>
	
	<p align="center"><img src="pix/cvstree.png" width="500" height="200" alt="cvstree" /></p>
	
	<p>Pour voir toutes les balises et branches actuellement disponibles, utilisez la commande suivante sur n'importe quel fichier suffisamment ancien (par exemple index.php dans le dossier principal de moodle) :</p>
	
	<div class="commandline">cvs status -v index.php</div>
	
	<p>Quelques recommandations au sujet des balises :</p>
	
	<ul>	
		
		<li>Les balises et les noms des branches doivent toujours être en lettres capitales.</li>	
		
		<li>Les balises et les noms des branches doivent TOUJOURS être appliqués sur <strong>l'intégralité du module</strong> (la totalité de Moodle). N'appliquez pas de balises à des fichiers individuels ou à des dossiers.</li>	
		
		<li>Il n'est pas autorisé de changer le nom des balises, car des développeurs comptent dessus ! Tapez-les donc correctement du premier coup.</li>	
	
	</ul>	
	
	<p> </p>	
	
	<h3><a name="sec4.1" id="sec4.1"></a>4.1 Développement du tronc</h3>
	
	<blockquote>
	
	<p>Dans le jargon CVS, le <strong>tronc</strong> (trunk) est la version principale en développement de Moodle. Elle est aussi appelée <span class="style4">HEAD</span>, ou encore branche par défaut.</p>
	
	<p>Les développeurs de Moodle font en sorte que le tronc reste aussi stable que possible, mais il contient d'habitude du nouveau code, avec des bogues et de petites instabilités.</p>
	
	<p>De temps à autre, nous décidons que le produit possède suffisamment de fonctionnalités pour sortir une version. Le tronc reçoit alors une balise  MOODLE_XX_BETA (pour le cas où l'on devrait revenir à ce point) et une nouvelle branche du nom de <span class="style1">MOODLE_XX_STABLE</span> est créée pour la nouvelle version.</p>
	
	<p>Une version bêta est aussi publiée à ce point. Elle est destinée aux testeurs qui n'utilisent pas CVS mais désirent essayer les dernières fonctionnalités et en rapporter les bogues.</p>
 
 	</blockquote>
  	     
  	     
	<p> </p>
	
	<h3><a name="sec4.2" id="sec4.2"></a>4.2 Branches stables pour chaque version</h3>
	
	<blockquote>
	
	<p>Dès que la branche stable <span class="style3">MOODLE_XX_STABLE</span> est créée, les efforts de développement se divisent temporairement en deux. Certains développeurs continuent à travailler sur de nouvelles fonctionnalités du tronc pour les prochaines versions, mais la plupart d'entre eux se concentrent sur la branche <span class="style1"><strong>STABLE</strong></span> actuelle et corrigent les bogues qui y sont découverts.</p>
	
	<p>Vous pouvez faire en sorte que votre copie locale de Moodle soit en synchronisation avec la version STABLE en tapant la commande unix suivante depuis le dossier principal de Moodle :</p>
	
	<div class="commandline">cvs update -dP -r <span class="style1">MOODLE_XX_STABLE</span></div>
	
	<p>À la suite de cela, toutes les commandes décrites ci-dessus s'appliqueront à la version stable. Pour revenir au tronc, tapez simplement :</p>
	
	<div class="commandline">cvs update -dPA</div>
	
	<p>Sous Windows, un menu devrait être disponible où vous pouvez choisir la branche.</p>
	
	<p>Lorsque la nouvelle branche STABLE se stabilise véritablement, une version est publiée. Les fichiers compressés sont créés pour la distribution et la branche reçoit de Martin une balise du nom de <strong>MOODLE_XXX</strong>.</p>
	
	<p>Périodiquement, les corrections de bogues de la branche STABLE doivent être incorporées dans le tronc afin qu'elles soient aussi disponibles dans les futures versions de Moodle. Une balise mobile appelée MOODLE_XX_MERGED sera maintenue pour garder une trace de la dernière incorporation. La procédure pour une telle incorporation se passe ainsi :</p>
	
	<ol>
		
		<li>Télécharger la toute dernière version du tronc :<br /><br />
		
		<div class="commandline">cvs update -dPA<span> </span></div></li>
		
		<li>Incorporer dans le tronc toutes les modifications de la branche effectuées depuis la dernière incorporation :<br /><br />
		
		<div class="commandline">cvs update -kk -j MOODLE_XX_MERGED -j MOODLE_XX_STABLE<span> </span></div></li>
		
		<li>Lire attentivement les historiques (logs) à la recherche d'éventuels conflits et corriger tous les fichiers concernés par ces conflits ;</li>
		
		<li>Appliquer la copie modifiée dans le tronc du CVS :<br /><br />
		
		<div class="commandline">cvs commit<span> </span></div></li>
		
		<li>Revenir à la branche stable ;<br /><br />
		
		<div class="commandline">cvs update -dPr MOODLE_XX_STABLE<span> </span></div></li>
		
		<li>Mettre à jour la balise mobile d'incorporation afin que la procédure puisse être répétée la prochaine fois :<br /><br />
		
		<div class="commandline">cvs tag -RF MOODLE_XX_MERGED<span> </span></div></li>
	
	</ol>
	
	<p>Enfin, les valeurs des variables <strong>$version</strong> de tous les fichiers « version.php » de Moodle de la branche stable ne doivent pas être mis à jour si possible (à part le dernier chiffre si nécessaire). La raison en est que si quelqu'un fait une mise à jour d'une version très stable à la version très stable suivante, il pourrait sans cela manquer une mise à jour arrivée sur le tronc.</p>
	
	</blockquote>
	
	<p> </p>
	
	<h3><a name="sec4.3" id="sec4.3"></a>4.3 Branches particulières pour tout changement important</h3>
	
	<blockquote>
	
	<p>Occasionnellement, il est nécessaire d'incorporer une nouvelle fonctionnalité afin que plusieurs développeurs puissent y travailler ensemble, même si elle est encore trop instable pour être incorporée dans le tronc.</p>
	
	<p>Dans ces cas, une branche temporaire est créée pour travailler sur la fonctionnalité, puis incorporée au tronc principal dès que possible. Un exemple de branche appelée <span class="style1"><strong>MOODLE_14_WIDGET</strong></span> peut être vu sur le diagramme ci-dessus.</p>
	
	<p>Si vous avez besoin de cela pour votre fonctionnalité WIDGET, suivez ces instructions :</p>
	
	<ol>
		
		<li>Discutez avec les autres développeurs pour vous assurer que c'est vraiment nécessaire !</li>
		
		<li>Créez une nouvelle balise sur le <strong>tronc</strong> (pour la totalité de moodle) avec le nom <strong>MOODLE_XX_WIDGET_PRE</strong><br /><br />
		
		<div class="commandline">cvs tag -R MOODLE_XX_WIDGET_PRE<span> </span></div></li>
		
		<li>Créez votre nouvelle branche avec le nom <span class="style1"><strong>MOODLE_XX_WIDGET</strong></span><br /><br />
		
		<div class="commandline">cvs tag -Rb <span class="style1"><strong>MOODLE_XX_WIDGET</strong></span></div></li>
		
		<li>Travaillez dans cette branche jusqu'à ce que la fonctionnalité soit raisonnablement stable. Copiez vos fichiers dans le CVS suivant vos besoins.<br /><br />
		
		<div class="commandline">cvs commit<span> </span></div></li>
		
		<li>Lorsque vous êtes prêt, incorporez toute la branche dans le tronc : copiez tous ses fichiers dans le tronc et abandonnez la branche.<br /><br />
		
		<div class="commandline">cvs update -dPA<br />
		cvs update -kk -j <span class="style1">MOODLE_XX_WIDGET</span><br />
		cvs commit</div></li>

	</ol>

	<p> </p>

	</blockquote>

	</blockquote>

	<p align="center">
		Bonne chance, soyez prudent et amusez-vous bien !</p>
	<p> </p>

</blockquote>

<p align="center"><font size="1"><a href="." >Documentation Moodle</a></font></p>
<p align="center"><font size="1">Version: $Id$</font></p>

</body>
</html>
